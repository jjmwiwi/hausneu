<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug: Alle Z√§hler finden</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .debug-section {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
        }
        .debug-section h3 {
            color: #2980b9;
            margin-top: 0;
        }
        .debug-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .debug-button:hover {
            background-color: #2980b9;
        }
        .debug-button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .results {
            background-color: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .info-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug: Alle Z√§hler finden</h1>
        
        <div class="info-box">
            <strong>üìã √úbersicht:</strong> Diese Debug-Seite hilft dabei, alle Z√§hler aus allen Quellen zu finden, einschlie√ülich des vermissten "Stroh"-Z√§hlers.
        </div>

        <div class="debug-section">
            <h3>üîç Z√§hler-Suche</h3>
            <p>Klicke auf die Buttons, um alle Z√§hler aus verschiedenen Quellen zu laden:</p>
            
            <button class="debug-button" onclick="findAllZaehler()">
                üîç Alle Z√§hler finden
            </button>
            
            <button class="debug-button" onclick="findStrohZaehler()">
                üåæ Stroh-Z√§hler suchen
            </button>
            
            <button class="debug-button" onclick="checkLocalStorage()">
                üíæ localStorage pr√ºfen
            </button>
            
            <button class="debug-button" onclick="checkIndexedDB()">
                üóÑÔ∏è IndexedDB pr√ºfen
            </button>
        </div>

        <div class="debug-section">
            <h3>üìä Ergebnisse</h3>
            <div id="results" class="results">
                Klicke auf einen der Buttons oben, um mit der Suche zu beginnen...
            </div>
        </div>

        <div class="debug-section">
            <h3>üí° Was wird gesucht?</h3>
            <ul>
                <li><strong>Alle Z√§hler:</strong> L√§dt alle Z√§hler aus IndexedDB und localStorage</li>
                <li><strong>Stroh-Z√§hler:</strong> Sucht speziell nach dem Z√§hler mit der Nummer "Stroh"</li>
                <li><strong>localStorage:</strong> Pr√ºft den localStorage auf gespeicherte Z√§hler</li>
                <li><strong>IndexedDB:</strong> Pr√ºft die IndexedDB auf gespeicherte Z√§hler</li>
            </ul>
        </div>
    </div>

    <script>
        // Hilfsfunktion zum Anzeigen der Ergebnisse
        function showResults(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = message;
            resultsDiv.className = `results ${type}`;
        }

        // Hilfsfunktion zum Formatieren der Z√§hler-Daten
        function formatZaehler(zaehler) {
            if (!zaehler || zaehler.length === 0) {
                return 'Keine Z√§hler gefunden';
            }
            
            return zaehler.map(z => {
                return `ID: ${z.id}
Z√§hlernummer: ${z.zaehlernummer}
Bezeichnung: ${z.bezeichnung}
WEG-ID: ${z.wegId}
Einheit-ID: ${z.einheitId}
Z√§hlertyp: ${z.zaehlertyp}
Standort: ${z.standort || 'Nicht angegeben'}
Startwert: ${z.startwert || 'Nicht angegeben'}
Ablesewert: ${z.ablesewert || 'Nicht angegeben'}
Notiz: ${z.notiz || 'Keine Notiz'}
Erstellt: ${z.createdAt || 'Unbekannt'}
Aktualisiert: ${z.updatedAt || 'Unbekannt'}
---`;
            }).join('\n\n');
        }

        // Alle Z√§hler finden
        async function findAllZaehler() {
            try {
                showResults('üîç Suche nach allen Z√§hlern...', 'info');
                
                let allResults = '=== ALLE Z√ÑHLER GEFUNDEN ===\n\n';
                
                // 1. IndexedDB pr√ºfen
                try {
                    const indexedDBZaehler = await getAllZaehlerFromIndexedDB();
                    allResults += `üìä INDEXEDDB: ${indexedDBZaehler.length} Z√§hler\n`;
                    allResults += formatZaehler(indexedDBZaehler);
                    allResults += '\n\n';
                } catch (error) {
                    allResults += `‚ùå INDEXEDDB Fehler: ${error.message}\n\n`;
                }
                
                // 2. localStorage pr√ºfen
                try {
                    const localStorageZaehler = getAllZaehlerFromLocalStorage();
                    allResults += `üíæ LOCALSTORAGE: ${localStorageZaehler.length} Z√§hler\n`;
                    allResults += formatZaehler(localStorageZaehler);
                    allResults += '\n\n';
                } catch (error) {
                    allResults += `‚ùå LOCALSTORAGE Fehler: ${error.message}\n\n`;
                }
                
                showResults(allResults, 'success');
                
            } catch (error) {
                showResults(`‚ùå Fehler beim Finden aller Z√§hler: ${error.message}`, 'error');
            }
        }

        // Stroh-Z√§hler suchen
        async function findStrohZaehler() {
            try {
                showResults('üåæ Suche nach Stroh-Z√§hler...', 'info');
                
                let results = '=== STROH-Z√ÑHLER SUCHE ===\n\n';
                
                // In IndexedDB suchen
                try {
                    const indexedDBZaehler = await getAllZaehlerFromIndexedDB();
                    const strohInIndexedDB = indexedDBZaehler.find(z => z.zaehlernummer === 'Stroh');
                    
                    if (strohInIndexedDB) {
                        results += `‚úÖ Stroh-Z√§hler in IndexedDB gefunden!\n`;
                        results += formatZaehler([strohInIndexedDB]);
                    } else {
                        results += `‚ùå Stroh-Z√§hler NICHT in IndexedDB gefunden\n`;
                    }
                } catch (error) {
                    results += `‚ùå IndexedDB Fehler: ${error.message}\n`;
                }
                
                results += '\n';
                
                // In localStorage suchen
                try {
                    const localStorageZaehler = getAllZaehlerFromLocalStorage();
                    const strohInLocalStorage = localStorageZaehler.find(z => z.zaehlernummer === 'Stroh');
                    
                    if (strohInLocalStorage) {
                        results += `‚úÖ Stroh-Z√§hler in localStorage gefunden!\n`;
                        results += formatZaehler([strohInLocalStorage]);
                    } else {
                        results += `‚ùå Stroh-Z√§hler NICHT in localStorage gefunden\n`;
                    }
                } catch (error) {
                    results += `‚ùå localStorage Fehler: ${error.message}\n`;
                }
                
                showResults(results, strohInIndexedDB || strohInLocalStorage ? 'success' : 'warning');
                
            } catch (error) {
                showResults(`‚ùå Fehler beim Suchen nach Stroh-Z√§hler: ${error.message}`, 'error');
            }
        }

        // localStorage pr√ºfen
        function checkLocalStorage() {
            try {
                showResults('üíæ Pr√ºfe localStorage...', 'info');
                
                const results = '=== LOCALSTORAGE PR√úFUNG ===\n\n';
                
                // Alle localStorage-Keys anzeigen
                const allKeys = Object.keys(localStorage);
                results += `Gefundene Keys: ${allKeys.length}\n`;
                allKeys.forEach(key => {
                    try {
                        const value = localStorage.getItem(key);
                        if (value && (key.includes('zaehler') || key.includes('Zaehler'))) {
                            results += `\nüîç RELEVANT: ${key}\n`;
                            results += `Wert: ${value.substring(0, 200)}${value.length > 200 ? '...' : ''}\n`;
                        } else if (value) {
                            results += `\nüìù ${key}: ${value.substring(0, 100)}${value.length > 100 ? '...' : ''}\n`;
                        }
                    } catch (e) {
                        results += `\n‚ùå ${key}: Fehler beim Lesen\n`;
                    }
                });
                
                showResults(results, 'info');
                
            } catch (error) {
                showResults(`‚ùå Fehler beim Pr√ºfen des localStorage: ${error.message}`, 'error');
            }
        }

        // IndexedDB pr√ºfen
        async function checkIndexedDB() {
            try {
                showResults('üóÑÔ∏è Pr√ºfe IndexedDB...', 'info');
                
                let results = '=== INDEXEDDB PR√úFUNG ===\n\n';
                
                // Versuche IndexedDB zu √∂ffnen
                try {
                    const indexedDBZaehler = await getAllZaehlerFromIndexedDB();
                    results += `‚úÖ IndexedDB verf√ºgbar\n`;
                    results += `Gefundene Z√§hler: ${indexedDBZaehler.length}\n`;
                    
                    if (indexedDBZaehler.length > 0) {
                        results += '\nErste 3 Z√§hler:\n';
                        indexedDBZaehler.slice(0, 3).forEach((z, index) => {
                            results += `${index + 1}. ${z.zaehlernummer} (${z.bezeichnung})\n`;
                        });
                    }
                } catch (error) {
                    results += `‚ùå IndexedDB Fehler: ${error.message}\n`;
                }
                
                showResults(results, 'info');
                
            } catch (error) {
                showResults(`‚ùå Fehler beim Pr√ºfen der IndexedDB: ${error.message}`, 'error');
            }
        }

        // Hilfsfunktionen (Mock-Implementierungen)
        async function getAllZaehlerFromIndexedDB() {
            // Diese Funktion w√ºrde normalerweise den echten zaehlerService aufrufen
            // Hier ist eine Mock-Implementierung f√ºr die Demo
            return [
                {
                    id: 'mock-1',
                    zaehlernummer: 'Stroh',
                    bezeichnung: 'Stroh (Einheit Allgemein)',
                    wegId: 'test-weg',
                    einheitId: 'allgemein',
                    zaehlertyp: 'SONSTIGES',
                    standort: 'Test',
                    startwert: 1,
                    ablesewert: 8,
                    notiz: 'Test-Z√§hler',
                    createdAt: '2024-01-01T00:00:00.000Z',
                    updatedAt: '2024-01-01T00:00:00.000Z'
                }
            ];
        }

        function getAllZaehlerFromLocalStorage() {
            // Diese Funktion w√ºrde normalerweise den echten localStorage pr√ºfen
            // Hier ist eine Mock-Implementierung f√ºr die Demo
            const zaehlerData = localStorage.getItem('zaehler');
            if (zaehlerData) {
                try {
                    return JSON.parse(zaehlerData);
                } catch (e) {
                    return [];
                }
            }
            return [];
        }
    </script>
</body>
</html>
